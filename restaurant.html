<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Restaurant</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
      integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
      crossorigin=""
    ></script>
    <style>
      h4 {
        display: inline;
      }
      h3 {
        font-size: 1em;
      }
      #mapid {
      height: 600px;
      width: 600px;
    
    }

    </style>
  </head>
  <body>
    
    <div id="allInfo"></div>
    <div id="mapid"></div>
    <script>
      fetch("all.json")
        .then(response => response.json())
        .then(jso => {
          restaurantList = jso;
          console.log(restaurantList);
          if (restaurantList.includes(window.location.hash.slice(1))) {
            let restaurantName = window.location.hash.slice(1);
            console.log(restaurantName);
            fetch(`${restaurantName}.json`)
              .then(response => response.json())
              .then(jso => {
                createPage(jso);
              });
          } else {
            console.log("404");
          }
        });

      function createPage(restaurantInfo) {
        let element = document.getElementById("allInfo");
        let name = document.createElement("h1");
        let address = document.createElement("p");
        let phoneLabel = document.createElement("h4");
        let phone = document.createElement("a");
        let hoursLabel = document.createElement("h4");
        let hours = document.createElement("a");
        let websiteLabel = document.createElement("h4");
        let website = document.createElement("a");
        let noteLabel = document.createElement("h3");
        let notes = document.createElement("ul");

        name.textContent = restaurantInfo.name;
        address.textContent = restaurantInfo.address;
        phoneLabel.textContent = "Phone number : ";
        phone.textContent = restaurantInfo.phone;
        phone.href = `tel:${restaurantInfo.phone}`;
        hoursLabel.textContent = "Hours : ";
        if (restaurantInfo.hours !== undefined) {
          hours.textContent = restaurantInfo.hours;
        } else {
          hours.textContent = "We show up whenever we feel like it!";
        }
        websiteLabel.textContent = "Website : ";
        if (restaurantInfo.website !== undefined) {
          website.textContent = restaurantInfo.website;
          website.href = restaurantInfo.website;
        } else {
          website.textContent = "Website coming soon!";
        }
        noteLabel.textContent = "Notes : ";

        restaurantInfo.notes.forEach(arrayItem => {
          let listItem = document.createElement("li");
          notes.appendChild(listItem);
          listItem.textContent = arrayItem;
          console.log(element);
        });
        
        element.appendChild(name);
        element.appendChild(address);
        element.appendChild(phoneLabel);
        element.appendChild(phone);
        element.appendChild(document.createElement("br"));
        element.appendChild(hoursLabel);
        element.appendChild(hours);
        element.appendChild(document.createElement("br"));
        element.appendChild(websiteLabel);
        element.appendChild(website);
        element.appendChild(noteLabel);
        element.appendChild(notes);
        
        let location = {};

        fetch(`https://nominatim.openstreetmap.org/search/?q=${restaurantInfo.address}&format=json`)
        .then(response => response.json())
        .then(jso => { 
            makeMap(jso.lat, jso.lon)
            console.log(jso[0].lat)
            console.log(jso[0].lon)
        })
        
        function makeMap(lat, long) {
            console.log(lat)
            console.log(long)
            var mymap = L.map('mapid').setView([lat, long], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(mymap);
        }
        
        
        
        
    }
        
        
        </script>
  </body>
</html>
